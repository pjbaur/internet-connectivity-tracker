input {
  tcp {
    port => 5044
    codec => json_lines
  }
}

filter {
  # Ensure core keys exist for downstream filters/dashboards
  if ![targetId] { mutate { add_field => { "targetId" => "unknown" } } }
  if ![method] { mutate { add_field => { "method" => "unknown" } } }
  if ![probeCycleId] { mutate { add_field => { "probeCycleId" => "unknown" } } }
  if ![reqId] { mutate { add_field => { "reqId" => "unknown" } } }
}

output {
  elasticsearch {
    hosts => [ "${ELASTICSEARCH_HOSTS:http://elasticsearch:9200}" ]
    index => "app-logs-%{+YYYY.MM.dd}"
  }
  stdout { codec => json }
}
